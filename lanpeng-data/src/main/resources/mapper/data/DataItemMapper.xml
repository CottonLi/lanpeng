<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lanpeng.data.mapper.DataItemMapper">

    <resultMap type="DataItemE" id="DataItemEResult">
        <id     property="id"           column="dataitem_id"  />
        <result property="code"         column="dataitem_code"/>
        <result property="name"         column="dataitem_name"/>
        <result property="type"         column="dataitem_type"/>
        <result property="displayed"    column="dataitem_displayed"/>
        <result property="description"  column="dataitem_description"/>
        <result property="delFlag"      column="del_flag"     />
        <result property="createBy"     column="create_by"    />
        <result property="createTime"   column="create_time"  />
        <result property="updateBy"     column="update_by"    />
        <result property="updateTime"   column="update_time"  />
        <result property="remark"       column="remark"       />
        <association property="module"  javaType="ModuleE"   resultMap="ModuleEResult"/>
    </resultMap>

    <resultMap type="ModuleE" id="ModuleEResult">
        <id     property="id"             column="module_id"/>
        <result property="name"           column="module_name"/>
    </resultMap>

    <select id="selectDataItemList" resultMap="DataItemEResult">
        select d.dataitem_id, d.dataitem_code, d.dataitem_name, d.dataitem_type, d.dataitem_displayed, d.dataitem_description,
               d.del_flag, d.create_by, d.create_time, d.update_by, d.update_time, d.remark,
               m.module_id,m.module_name
        from dataitem d
                 left join module m on d.dataitem_moduleid = m.module_id
        where d.del_flag = '0'
    </select>

    <select id="selectDataItemById" parameterType="Long" resultMap="DataItemEResult">
        select d.dataitem_id, d.dataitem_code, d.dataitem_name, d.dataitem_type, d.dataitem_displayed, d.dataitem_description,
               d.del_flag, d.create_by, d.create_time, d.update_by, d.update_time, d.remark,
               m.module_id,m.module_name
        from dataitem d
                 left join module m on d.dataitem_moduleid = m.module_id
        where d.dataitem_id = #{diid} and d.del_flag = '0'
    </select>

    <insert id="insertDataItem" parameterType="DataItemE">
        insert into DataItem(dataitem_moduleid,dataitem_code,dataitem_name,dataitem_type,dataitem_displayed,dataitem_description,
                             <if test="di.createBy != null and di.createBy != ''">create_by,</if>
                             <if test="di.remark != null and di.remark != ''">remark,</if>
                             create_time)
        values(#{di.module.id},#{di.code},#{di.name},#{di.type},#{di.displayed},#{di.description},
               <if test="di.createBy != null and di.createBy != ''">#{di.createBy},</if>
               <if test="di.remark != null and di.remark != ''">#{di.remark},</if>
               sysdate())
    </insert>

    <update id="updateDataItem" parameterType="DataItemE">
        update dataitem
        <set>
            dataitem_moduleid = #{di.module.id},
            dataitem_code = #{di.code},
            dataitem_name = #{di.name},
            dataitem_type = #{di.type},
            dataitem_displayed = #{di.displayed},
            dataitem_description = #{di.description},
            <if test="di.updateBy != null and di.updateBy != ''">update_by = #{di.updateBy},</if>
            <if test="di.remark != null">remark = #{di.remark},</if>
            update_time = sysdate()
        </set>
        where dataitem_id = #{di.id}
    </update>

    <delete id="deleteDataItemById" parameterType="Long">
        update dataitem set del_flag = '2' where dataitem_id = #{diid}
    </delete>

</mapper>