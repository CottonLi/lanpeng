<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lanpeng.data.mapper.Role2DataItemMapper">

    <resultMap type="Role" id="RoleResult">
        <result property="id"           column="role_id"      />
        <result property="name"         column="role_name"   />
    </resultMap>

    <resultMap type="DataItem" id="RDDataItemResult">
        <id     property="id"             column="id"  />
        <result property="code"           column="code"/>
        <result property="dataName"       column="dataName"/>
        <result property="dataType"       column="dataType"/>
        <result property="dataPrecision"  column="dataPrecision"/>
        <result property="unit"           column="unit"/>
        <result property="nodeType"       column="nodeType"/>
        <result property="nodeId"         column="nodeId"/>
        <result property="mappingField"   column="mappingField"/>
        <result property="store_flag"     column="store_flag"/>
        <result property="transfer_flag"  column="transfer_flag"/>
        <result property="display_flag"   column="display_flag"/>
        <result property="control_flag"   column="control_flag"/>
        <result property="alarm_flag"     column="alarm_flag"/>
        <result property="delFlag"        column="del_flag"     />
        <result property="createBy"       column="create_by"    />
        <result property="createTime"     column="create_time"  />
        <result property="updateBy"       column="update_by"    />
        <result property="updateTime"     column="update_time"  />
        <result property="remark"         column="remark"       />
    </resultMap>

    <select id="getRolesByUserId" resultMap="RoleResult">
        select r.role_id,r.role_name
        from sys_user_role ur
                 left join sys_role r on ur.role_id = r.role_id
        where ur.user_id = #{uid}
    </select>

    <select id="getDataItemsByRoleId" resultMap="RDDataItemResult">
        select di.id,di.code,di.dataName,di.dataType,di.dataPrecision,di.unit,di.nodeType,di.nodeId,di.mappingField,
               di.store_flag,di.transfer_flag,di.display_flag,di.control_flag,di.alarm_flag,
               di.del_flag, di.create_by, di.create_time, di.update_by, di.update_time, di.remark
        from sys_role_dataitem rd
                 left join dataitem di on rd.dataitemid = di.id
        where rd.roleid = #{rid} and di.del_flag = '0'
    </select>

    <insert id="addDataItem2Role">
        insert into sys_role_dataitem (roleid,dataitemid)values(#{rid},#{diid})
    </insert>

    <insert id="addDataItems2Role">
        insert into sys_role_dataitem (roleid,dataitemid)values
        <foreach collection="diids" item="diid" separator=",">
            (#{rid},#{diid})
        </foreach>

    </insert>

    <delete id="deleteDataItemByRoleId" parameterType="Long">
        delete from sys_role_dataitem where roleid = #{rid}
    </delete>

</mapper>